---
date: 2024-09-06
tags:
  - Процедурне_програмування
  - Налагодження
---
Під час налагодження програми, в більшості випадків, переважна більшість вашого часу буде витрачена на пошук помилки. Після того, як проблему знайдено, решта кроків (виправлення проблеми та перевірка того, що проблему було виправлено) часто є тривіальними у порівнянні з цим.

У цьому уроці ми почнемо вивчати, як знаходити помилки.
## Пошук проблем за допомогою інспекції коду
Припустимо, ви помітили проблему і хочете відстежити її причину. У багатьох випадках (особливо в невеликих програмах) ми можемо швидко визначити, де саме виникла проблема.

Розглянемо наступний фрагмент програми:

```cpp
int main()
{
    getNames(); // ask user to enter a bunch of names
    sortNames(); // sort them in alphabetical order
    printNames(); // print the sorted list of names

    return 0;
}
```

Якщо ви очікували, що програма надрукує імена в алфавітному порядку, а вона надрукувала їх у протилежному порядку, проблема, ймовірно, у функції `sortNames`. У випадках, коли ви можете звести проблему до конкретної функції, ви можете виявити її, просто подивившись на код.

Однак, оскільки програми стають складнішими, пошук проблем за допомогою перевірки коду також стає складнішим.

По-перше, потрібно переглянути набагато більше коду. Перегляд кожного рядка коду в програмі, яка складається з тисяч рядків, може зайняти дуже багато часу (не кажучи вже про те, що це неймовірно нудно). По-друге, сам код, як правило, складніший, з більшою кількістю можливих помилок. По-третє, поведінка коду може не давати вам багато підказок про те, де щось йде не так. Якщо ви написали програму, яка виводить рекомендації щодо акцій, а вона насправді нічого не виводить, ви, ймовірно, не матимете уявлення про те, з чого почати шукати проблему.

Нарешті, помилки можуть бути викликані неправильними припущеннями. Практично неможливо візуально виявити помилку, спричинену неправильним припущенням, тому що ви, швидше за все, зробите таке ж неправильне припущення при перевірці коду і не помітите помилку. Отже, якщо у нас є проблема, яку ми не можемо знайти за допомогою інспекції коду, як ми її знайдемо?
## Пошук проблем шляхом запуску програми
На щастя, якщо ми не можемо знайти проблему за допомогою інспекції коду, є інший шлях: ми можемо спостерігати за поведінкою програми під час її роботи і спробувати діагностувати проблему на основі цього. Цей підхід можна узагальнити наступним чином:

1. З'ясуйте, як відтворити проблему
2. Запустіть програму та зберіть інформацію, щоб звузити коло проблем
3. Повторюйте попередній крок, поки не знайдете проблему

Далі в цій главі ми обговоримо методи, які полегшують такий підхід.
## Відтворення проблеми
Перший і найважливіший крок у пошуку проблеми - це вміння відтворити проблему. Відтворення проблеми означає, що проблема з'являється в послідовному вигляді. Причина проста: надзвичайно важко знайти проблему, якщо ви не бачите, як вона виникає.

Повернемося до нашої аналогії з автоматом для льоду - припустимо, одного дня ваш друг каже вам, що автомат для льоду не працює. Ви йдете подивитися на нього, а він працює нормально. Як би ви діагностували проблему? Це було б дуже складно. Однак, якби ви дійсно бачили проблему несправності автомата з льодом, ви могли б почати діагностувати, чому він не працює, набагато ефективніше.

Якщо проблема з програмним забезпеченням очевидна (наприклад, програма вилітає в одному і тому ж місці щоразу, коли ви її запускаєте), то відтворення проблеми може бути тривіальним. Однак іноді відтворення проблеми може бути набагато складнішим. Проблема може виникати лише на певних комп'ютерах або за певних обставин (наприклад, коли користувач вводить певні дані). У таких випадках може бути корисним створення набору кроків відтворення. **Кроки відтворення** - це перелік чітких і точних дій, які можна виконати, щоб викликати повторення проблеми з високим рівнем передбачуваності. Мета полягає в тому, щоб викликати повторення проблеми якомога частіше, щоб ми могли запускати нашу програму знову і знову і шукати підказки, щоб визначити, що викликає проблему. Якщо проблему можна відтворити у 100% випадків, це ідеально, але відтворюваність менше 100% може бути нормальною. Проблема, яка виникає лише в 50% випадків, просто означає, що діагностика займе вдвічі більше часу, оскільки в половині випадків програма не буде показувати проблему і, таким чином, не надасть жодної корисної діагностичної інформації.
## Фокусування на проблемах
Після того, як ми зможемо відтворити проблему, наступний крок - з'ясувати, де саме в коді вона знаходиться. Залежно від характеру проблеми, це може бути легко або важко. Для прикладу, уявімо, що ми не дуже добре уявляємо, де саме знаходиться проблема. Як нам її знайти?

Тут нам допоможе аналогія. Давайте пограємо в гру "hi-lo". Я попрошу вас вгадати число від 1 до 10. За кожне вгадане вами число я буду казати вам, чи є воно завищеним, заниженим або правильним. Приклад цієї гри може виглядати так:

```
You: 5
Me: Too low
You: 8
Me: Too high
You: 6
Me: Too low
You: 7
Me: Correct
```

У наведеній вище грі вам не потрібно відгадувати всі числа, щоб знайти число, про яке я думаю. В процесі вгадування та з урахуванням інформації, яку ви отримуєте з кожного вгадування, ви можете "дістатися" до правильного числа лише за кілька вгадувань (якщо ви використовуєте оптимальну стратегію, ви завжди можете знайти число, про яке я думаю, за 4 або менше вгадувань).

Ми можемо використовувати подібний процес для налагодження програм. У найгіршому випадку, ми можемо не мати уявлення про те, де знаходиться помилка. Однак ми знаємо, що проблема має бути десь у коді, який виконується між початком програми і моментом, коли програма демонструє перший неправильний симптом, який ми можемо спостерігати. Це принаймні виключає частини програми, які виконуються після першого помітного симптому. Але це все ще потенційно залишає багато коду, який потрібно перевірити. Щоб діагностувати проблему, ми зробимо кілька обґрунтованих припущень про те, де саме проблема, з метою швидкого її вирішення.

Часто, незалежно від того, що змусило нас помітити проблему, ми можемо зробити первинне припущення, яке буде близьким до того, де знаходиться справжня проблема. Наприклад, якщо програма не записує дані до файлу, коли повинна, то проблема, ймовірно, десь у коді, який обробляє запис до файлу (ага!). Тоді ми можемо використати стратегію привітання, щоб спробувати визначити, де насправді проблема.

Наприклад:
- Якщо на певному етапі виконання програми ми можемо довести, що проблема ще не виникла, це аналогічно отриманню результату hi-lo "занадто низький" - ми знаємо, що проблема має бути десь далі в програмі. Наприклад, якщо наша програма кожного разу падає в одному і тому ж місці, і ми можемо довести, що програма не падає в певній точці виконання програми, значить, проблема повинна бути десь далі в коді.
- Якщо в якомусь місці нашої програми ми спостерігаємо некоректну поведінку, пов'язану з проблемою, то це аналогічно отриманню "занадто високого" результату hi-lo, і ми знаємо, що проблема повинна бути десь раніше в програмі. Наприклад, скажімо, програма виводить значення деякої змінної x. Ви очікували, що вона виведе значення 2, а вона вивела 8. Змінна x повинна мати неправильне значення. Якщо в якийсь момент під час виконання програми ми бачимо, що змінна x вже має значення 8, то ми знаємо, що проблема виникла до цього моменту.

Аналогія з hi-lo не є ідеальною - ми також іноді можемо вилучати з розгляду цілі секції нашого коду, не отримуючи жодної інформації про те, де саме виникла проблема - до чи після цієї точки.

Ми покажемо приклади всіх трьох цих випадків у наступному уроці.

Зрештою, маючи достатньо здогадок і хорошу техніку, ми зможемо знайти точний рядок, що викликає проблему! Якщо ми зробили якісь неправильні припущення, це допоможе нам виявити, де саме. Коли ви виключили все інше, має залишитися тільки те, що викликає проблему. Тоді це просто питання розуміння, чому.

Яку стратегію здогадок ви хочете використовувати, вирішувати вам - найкраща стратегія залежить від типу помилки, тому вам, швидше за все, захочеться спробувати багато різних підходів, щоб звузити проблему. Коли ви набудете досвіду у налагодженні проблем, ваша інтуїція допоможе вам у цьому.

Так як же нам "робити припущення"? Існує багато способів зробити це. У наступному розділі ми почнемо з деяких простих підходів, а потім розвинемо їх і розглянемо інші в наступних розділах.